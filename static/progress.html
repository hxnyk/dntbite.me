<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="icon.png">

	<script src="chart.js"></script>
    <script src="jquery-2.1.3.js"></script>
	<script src="bootstrap.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
    <title>dnt bite me</title>

    <link href="bootstrap2.css" rel="stylesheet">
    <link href="dashboard.css" rel="stylesheet">

  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand">dnt bite me, neil</a>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
          <ul class="nav nav-sidebar">
		  
            <li class="active">
				<a href="#" style="padding:3vh; font-size: 1.25em">Progress <span class="sr-only">(current)</span></a>
			</li>
            <li>
				<a href="settings.html" style="padding:3vh; font-size: 1.25em">Settings</a>
			</li>
            <li>
				<a href="index.html" style="padding:3vh; font-size: 1.25em">Log Out</a>
			</li>			
          </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h1 class="page-header">Your progress thus far:</h1>

		<canvas id="progressChart" width="800px" height="400px"></canvas>
				
		<script type="text/javascript">
			var progressData = {
			labels : ["January","February","March","April","May","June"],
			datasets : [
				{
					fillColor : "rgba(172,194,132,0.4)",
					strokeColor : "#ACC26D",
					pointColor : "#fff",
					pointStrokeColor : "#9DB86D",
					data : [203,156,99,251,305,247]
				}]}
			var progressChart = document.getElementById('progressChart').getContext('2d');
			new Chart(progressChart).Line(progressData);
			
			// FIREBASE : Get a reference to our posts
			var ref = new Firebase("https://docs-examples.firebaseio.com/web/saving-data/fireblog/posts");
			// Retrieve new posts as they are added to Firebase
			ref.on("child_added", function(snapshot) {
			  var newTime = snapshot.val();
			  console.log("time" + newTime.author);
			});
			
		</script>		  
		  <hr>
		  
			<div class="list-group">
				<a href="#" id="ticker" class="list-group-item">You've been bite free for the past 0 seconds!</a>
			</div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    // Load posts from firebase
    var ref = new Firebase("dntbite.firebaseio.com/users/neil");
    var bittenTime = 0.0;
    ref.child("lastBittenTime").once(
        "value", function(data) {
        bittenTime = data.val();
    })
    setInterval(updateTicker, 1000);
    function updateTicker() {
    	var secondsSince = Math.round((new Date().getTime() / 1000) - bittenTime);
    	if (secondsSince < 60) {
	    	document.getElementById("ticker").innerHTML = "You've been bite free for the past " + secondsSince.toString() + " second(s)!";
    	} else if(secondsSince < 3600) {
    		var minutesSince = Math.floor(secondsSince/60);
    		var secondsSince = secondsSince - minutesSince*60;
    		document.getElementById("ticker").innerHTML = "You've been bite free for the past " + minutesSince.toString() + " minute(s) and " + secondsSince.toString() + " second(s)!";
    	} else if(secondsSince < 3600*24) {
			var hoursSince = Math.floor(secondsSince/3600);
    		var minutesSince = Math.floor((secondsSince - hoursSince*3600)/60);
    		var secondsSince = secondsSince - hoursSince*3600 - minutesSince*60;
    		document.getElementById("ticker").innerHTML = "You've been bite free for the past " + hoursSince.toString() + " hour(s), " + minutesSince.toString() + " minute(s) and " + secondsSince.toString() + " second(s)!";
    	}
    }
  </script>
</html>
